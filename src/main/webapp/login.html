<!DOCTYPE html>
<html lang="en" class="no-js">
<head>

<meta charset="utf-8">
<title>登录(Login)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<!-- CSS -->
<link rel="stylesheet" href="css/login.css">
<link rel="stylesheet" href="css/supersized.css">
</head>
<body>
	<div class="page-container">
		<h1>登录（Login）</h1>
		<input type="text" id="userName" placeholder="请输入您的用户名！" style="width: 300px; float: left;">
		<input type="password" id="password" placeholder="请输入您的用户密码！" style="width: 300px; float: left;">
		<!-- 			<input type="text" name="Captcha" placeholder="请输入验证码！" style="width:200px; float:left;"> -->
		<button type="button" style="font-size: 24px; width: 200px; outline: none;" onclick="login()">登&nbsp;&nbsp;&nbsp;&nbsp;录</button>
		<span id="is_login_span" style="display: none; margin-top: 5px; margin-left: 15px; width: 300px; float: left;">
			　您可以<a href="javascript:void(0);" id="forward_a">直接登录</a>或<a href="javascript:void(0);" id="forward_b">注销</a>
		</span>
		<span id="update_pw" style="margin-top: 5px; margin-left: 20px; width: 300px; float: left;">
			<a href="pwd.html" id="forward_pw">修改密码</a>
		</span>
	</div>
	<!-- Javascript -->
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>
	<script type="text/javascript" src="js/domainhelp.js"></script>
	<script type="text/javascript" src="js/supersized.3.2.7.min.js"></script>
	<script>
		var domain = $domain.getDomain();
		jQuery(document).ready(function() {
			$.supersized({
				//Functionality
				slideshow : 1, //Slideshow on/off
				autoplay : 1, //Slideshow starts playing automatically
				start_slide : 1, //Start slide (0 is random)
				random : 1, //Randomize slide order (Ignores start slide)
				slide_interval : 3000, //Length between transitions
				transition : 0, //0-None, 1-Fade, 2-Slide Top, 3-Slide Right, 4-Slide Bottom, 5-Slide Left, 6-Carousel Right, 7-Carousel Left
				transition_speed : 700, //Speed of transition
				new_window : 1, //Image links open in new window/tab
				pause_hover : 0, //Pause slideshow on hover
				keyboard_nav : 1, //Keyboard navigation on/off
				performance : 1, //0-Normal, 1-Hybrid speed/quality, 2-Optimizes image quality, 3-Optimizes transition speed // (Only works for Firefox/IE, not Webkit)
				image_protect : 1, //Disables image dragging and right click with Javascript
	
				//Size & Position
				min_width : 0, //Min width allowed (in pixels)
				min_height : 0, //Min height allowed (in pixels)
				vertical_center : 1, //Vertically center background
				horizontal_center : 1, //Horizontally center background
				fit_portrait : 1, //Portrait images will not exceed browser height
				fit_landscape : 0, //Landscape images will not exceed browser width
	
				//Components
				navigation : 1, //Slideshow controls on/off
				thumbnail_navigation : 1, //Thumbnail navigation
				slide_counter : 1, //Display slide numbers
				slide_captions : 1, //Slide caption (Pull from "title" in slides array)
				slides : [ // 幻灯片影像
				{
					image : 'images/login/1.jpg',
					title : '1'
				}, {
					image : 'images/login/2.jpg',
					title : '2'
				}, {
					image : 'images/login/3.jpg',
					title : '3'
				} ]
			});
		});
		var getQueryString = function(name) {
			var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
			var r = window.location.search.substr(1).match(reg);
			if (r != null) {
				return unescape(r[2]);
			}
			return null;
		};
		$.get("userservice/checkuser.do", function(data) {
			if (data != undefined && data.split(",", 2)[0] == "true") {
				$("#is_login_span").css('display', 'block');
				$("#forward_a").click(function() {
					location.href = getQueryString("url");
				});
				$("#forward_b").click(function() {
					removeCookie();
					window.location.reload();
				});
				// 				var r = confirm("您已经登录，确定要重新登录吗？");
				// 				if (r) {
				// 				} else {
				// 					location.href = getQueryString("url");
				// 				}
			}
		});
		var cookie_id = "MYSESSIONID";
		var login = function() {
			var userName = $("#userName").val();
			var password = $("#password").val();
			if (userName == "") {
				alert("请填写用户名");
				return;
			}
			if (password == "") {
				alert("请填写密码");
				return;
			}
			$("#is_login_span").css('display', 'none');
			removeCookie();
			$.get("userservice/login.do", {
				userName : userName,
				password : password
			}, function(data) {
				if (data.status == 200) {
					var expires = new Date();
					expires.setTime(expires.getTime() + (30 * 60 * 1000));
					$.cookie(cookie_id, data.sessionId, {
						path : "/",
						expires : expires,
						domain : domain
					});
					alert(data.message);
					location.href = getQueryString("url");
				} else {
					alert(data.message);
				}
			});
		};
		$("#userName").focus();
		$("input").keydown(function(event) {
			var e = event || window.event || arguments.callee.caller.arguments[0];
			// 按 Esc 
			if (e && e.keyCode == 27) {
				$("#userName").val("");
				$("#password").val("");
				$("#userName").focus();
			}
			// enter 键
			if (e && e.keyCode == 13) {
				login();
			}
		});
		var removeCookie = function() {
			var expires = new Date();
			expires.setTime(expires.getTime() - (30 * 60 * 1000));
			$.cookie(cookie_id, "", {
				path : "/",
				expires : expires,
				domain : domain
			});
		};
	</script>
</body>
</html>


