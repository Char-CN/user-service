<input ds_index="search_user_name">
<table ds_index="user_tables"></table>
<script>
	$(function() {
		var windowId = '$windowId';
		var this_window = $("#" + windowId);
		// 		alert(this_window.html());
		// 		$.ds.commons.openDialog("user_role_config", $.ds.icon.user + "&nbsp;" + $.ds.icon.role, "用户角色配置", "user_role_config.html");

		// 搜索框
		this_window.DSFind("search_user_name").searchbox({
			width : "100%",
			searcher : function(value, name) {
				if (value != undefined) {
					table.datagrid('reload', {
						userName : value
					});
				}
			},
			prompt : '请输入用户名或者中文名...'
		});

		// 刷新
		var a_reload = $('<a href="javascript:void(0)" class="icon-reload"></a>');
		this_window.parent().find(" .panel-tool").prepend(a_reload);
		a_reload.click(function() {
			table.datagrid('reload');
		});
		// 编辑
		var a_edit = $('<a href="javascript:void(0)" class="icon-edit"></a>');
		this_window.parent().find(" .panel-tool").prepend(a_edit);
		a_edit.click(function() {
			var selected = table.datagrid('getSelected');
			var idx = table.datagrid('getRowIndex', selected);
			if (selected == undefined || selected == null) {
				$.ds.show('请选择一个用户！');
				return;
			}
			$.ds.commons.openDialog("user_add", $.ds.icon.user, "用户编辑", "users/user_add.html", "id=" + selected.id, {
				onClose : function() {
					table.datagrid('reload');
					setTimeout(function() {
						table.datagrid('selectRow', idx);
					}, 200);
				}
			}).dialog('resize', {
				height : 420
			});
		});
		// 增加
		var a_add = $('<a href="javascript:void(0)" class="icon-add"></a>');
		this_window.parent().find(" .panel-tool").prepend(a_add);
		a_add.click(function() {
			$.ds.commons.openDialog("user_add", $.ds.icon.user, "用户增加", "users/user_add.html", null, {
				onClose : function() {
					table.datagrid('getPager').pagination('select', 99999999);
				}
			}).dialog('resize', {
				height : 420
			});
		});

		var table = this_window.DSFind("user_tables");
		// 		this_window.append(table);
		table.datagrid({
			url : $.ds.url.find_user_by_page,
// 			queryParams : { userName : "asdass" },
			method : 'post',
			singleSelect : true,
			columns : [ [ {
				field : 'id',
				title : 'id',
				hidden : true
			}, {
				field : 'userName',
				width : "15%",
				title : '用户名'
			}, {
				field : 'userNameCn',
				width : "15%",
				title : '中文名'
			}, {
				field : 'phoneNumber',
				width : "15%",
				title : '电话号码'
			}, {
				field : 'email',
				width : "20%",
				title : '邮箱'
			}, {
				field : 'remark',
				width : "32%",
				title : '备注'
			} ] ],
			rownumbers : true,
			singleSelect : true,
			autoRowHeight : false,
			pagination : true,
			striped : true,
			pageSize : 10,
			pagePosition : 'bottom'
		}).datagrid('getPager').pagination({
			pageList : [ 10, 20, 50, 100 ],
			links : 5,
			displayMsg : '当前显示　{from} - {to}　条记录,共　{total}　条记录',
			layout : [ 'list', 'sep', 'first', 'prev', 'sep', 'links', 'sep', 'next', 'last', 'sep', 'refresh' ]
		});
	});
</script>
